import ROOT
# Since a Gaussian will be fitted with Legendre polynomial, x should be in [-1,1]
x = ROOT.RooRealVar("x", "x", -1, 1)
mean = ROOT.RooRealVar("mean", "mean of gaussian", 0, -1, 1)
sigma = ROOT.RooRealVar("sigma", "width of gaussian", 0.08, 0.001, 10)
gauss = ROOT.RooGaussian("gauss", "gaussian PDF", x, mean, sigma)
b = ROOT.RooRealVar("b", "b", 0.9, 0.001, 10)
#cob = ROOT.RooRealVar("cob", "cob", 0.5, 0, 1)
gaussup = ROOT.RooGenericPdf("gaussup","gaussup","@0+0.5",ROOT.RooArgList(gauss))

xframe = x.frame(ROOT.RooFit.Title("Gaussian p.d.f."))
gaussup.plotOn(xframe)
# Generating data
data = gaussup.generate(ROOT.RooArgSet(x), 100000)

# defining Legendre polynomial
le0 = ROOT.RooLegendre("le0","le0",x,0) 
co0 = ROOT.RooRealVar("co0","co0",1,-10,10)

le2 = ROOT.RooLegendre("le2","le2",x,2) 
co2 = ROOT.RooRealVar("co2","co2",1,-10,10)
le4 = ROOT.RooLegendre("le4","le4",x,4) 
co4 = ROOT.RooRealVar("co4","co4",1,-10,10)
le6 = ROOT.RooLegendre("le6","le6",x,6) 
co6 = ROOT.RooRealVar("co6","co6",1,-10,10)
le8 = ROOT.RooLegendre("le8","le8",x,8) 
co8 = ROOT.RooRealVar("co8","co8",1,-10,10)
le10 = ROOT.RooLegendre("le10","le10",x,10)
co10 = ROOT.RooRealVar("co10","co10",1,-10,10)

le12 = ROOT.RooLegendre("le12","le12",x,12) 
co12 = ROOT.RooRealVar("co12","co12",1,-10,10)
le14 = ROOT.RooLegendre("le14","le14",x,14) 
co14 = ROOT.RooRealVar("co14","co14",1,-10,10)
le16 = ROOT.RooLegendre("le16","le16",x,16) 
co16 = ROOT.RooRealVar("co16","co16",1,-10,10)
le18 = ROOT.RooLegendre("le18","le18",x,18) 
co18 = ROOT.RooRealVar("co18","co18",1,-10,10)
le20 = ROOT.RooLegendre("le20","le20",x,20) 
co20 = ROOT.RooRealVar("co20","co20",1,-10,10)

leg1 = ROOT.RooFormulaVar("leg1","leg1","@0*@1+@2*@3+@4*@5+@6*@7",ROOT.RooArgList(co2,le2,co4,le4,co6,le6,co8,le8))
leg2 = ROOT.RooFormulaVar("leg2","leg2","@0*@1+@2*@3+@4*@5+@6*@7",ROOT.RooArgList(co10,le10,co12,le12,co14,le14,co16,le16))
leg3 = ROOT.RooFormulaVar("leg3","leg3","@0*@1+@2*@3+@4*@5",ROOT.RooArgList(co18,le18,co20,le20,co0,le0))
xframe2 = x.frame(ROOT.RooFit.Title("Gaussian p.d.f. with data"))
leg = ROOT.RooGenericPdf("leg","leg","@0+@1+@2",ROOT.RooArgList(leg1,leg2,leg3))

# Plotting stuff
data.plotOn(xframe2)
gaussup.plotOn(xframe2)
gaussup.fitTo(data)
#gaussup.plotOn(xframe2)
leg.fitTo(data)
leg.plotOn(xframe, ROOT.RooFit.LineColor(ROOT.kRed))
leg.plotOn(xframe2, ROOT.RooFit.LineColor(ROOT.kRed))
mean.Print()
sigma.Print()
c = ROOT.TCanvas("rf101_basics", "rf101_basics", 800, 400)
c.Divide(2)
c.cd(1)
ROOT.gPad.SetLeftMargin(0.15)
xframe.GetYaxis().SetTitleOffset(1.6)
xframe.Draw()
c.cd(2)
ROOT.gPad.SetLeftMargin(0.15)
xframe2.GetYaxis().SetTitleOffset(1.6)
xframe2.Draw()
c.SaveAs("rf101_basics.png")
